<style>

    #editor-panel,
    #asset-editor-panel,
    #avatar-editor-panel,
    #outfit-editor-panel {
        width:100% !important;
        min-width:100% !important;
        max-width:100% !important; 
        min-height:550px !important;
        max-height:550px !important; 
        background-color:#000000;
    }

    .col-panel {
        height:auto; 
        border:black 1px solid;
        padding-top:0px; padding-bottom:0px;
        color:#ffffff;
    }

    .col-panel a { color:#ffffff; }
    .col-panel h4 { margin-top:20px; }
    .col-panel input, 
    .col-panel label{ font-family: Arial, sans-serif; font-size:14px; }

    .sp-container { width:100%; background-color:#000000; border:none; }
    .sp-input { color:#ffffff; border:none; }
    .sp-picker-container { width:90%; border:none; }

    .texture-btn { 
    /*  margin-top:15px;  */
        margin-bottom:15px; 
    }

    .panel-controls-output { 
        width:50px; outline:none;
        color:#ffffff; border:none; background-color:rgba(255,255,255,0); 
        font-weight:bold; font-size:1em; text-align:right; font-family:Arial;
    }

    .ui-widget-overlay { 
        background:none;
        opacity:0;
    }

</style>


<!-- MeshLambertMaterial options -->

<div id="lambert-material-panel-left-col" class="col-md-6 col-panel">


    <h4><input type="checkbox" id="check-emissiveMap" class="one-4-all"> Emissive map:</h4>

    <div class="btn btn-primary btn-white-outline form-control texture-btn" id="import-emissiveMap-btn">Import emissive map</div>

    <a id="library-emissiveMap" name="library-emissiveMap" class="nav-link btn btn-default btn-white-outline import-texture-btn" 
    style="width:79px; height:79px; background-image: url('https://i.imgur.com/Fi1O5YL.png'); background-size: contain; 
    background-position:50% 50%; background-repeat:no-repeat;" title="Import from library"></a>

    <a id="internet-emissiveMap" name="internet-emissiveMap" class="nav-link btn btn-default btn-white-outline import-texture-btn" 
    style="width:79px; height:79px; background-image: url('https://i.imgur.com/m8ZMtd5.png'); background-size: contain; 
    background-position:50% 50%; background-repeat:no-repeat;" title="Import from internet"></a>

    <a id="desktop-emissiveMap" name="desktop-emissiveMap" class="nav-link btn btn-default btn-white-outline import-texture-btn" 
    style="width:79px; height:79px; background-image: url('https://i.imgur.com/vfpmSfl.png'); background-size: contain; 
    background-position:50% 50%; background-repeat:no-repeat;" title="Import from desktop"></a>

    <a id="remove-emissiveMap" name="remove-emissiveMap" class="nav-link btn btn-default btn-white-outline remove-texture-btn" 
    style="width:79px; height:79px; background-image: url('https://i.imgur.com/R7Iu9bW.png'); background-size: contain; 
    background-position:50% 50%; background-repeat:no-repeat; display:none;" title="Remove texture"></a>



    <h4><input type="checkbox" id="check-specularMap" class="one-4-all"> Specular map:</h4>

    <div class="btn btn-primary btn-white-outline form-control texture-btn" id="import-specularMap-btn">Import specular map</div>

    <a id="library-specularMap" name="library-specularMap" class="nav-link btn btn-default btn-white-outline import-texture-btn" 
    style="width:79px; height:79px; background-image: url('https://i.imgur.com/Fi1O5YL.png'); background-size: contain; 
    background-position:50% 50%; background-repeat:no-repeat;" title="Import from library"></a>

    <a id="internet-specularMap" name="internet-specularMap" class="nav-link btn btn-default btn-white-outline import-texture-btn" 
    style="width:79px; height:79px; background-image: url('https://i.imgur.com/m8ZMtd5.png'); background-size: contain; 
    background-position:50% 50%; background-repeat:no-repeat;" title="Import from internet"></a>

    <a id="desktop-specularMap" name="desktop-specularMap" class="nav-link btn btn-default btn-white-outline import-texture-btn" 
    style="width:79px; height:79px; background-image: url('https://i.imgur.com/vfpmSfl.png'); background-size: contain; 
    background-position:50% 50%; background-repeat:no-repeat;" title="Import from desktop"></a>

    <a id="remove-specularMap" name="remove-specularMap" class="nav-link btn btn-default btn-white-outline remove-texture-btn" 
    style="width:79px; height:79px; background-image: url('https://i.imgur.com/R7Iu9bW.png'); background-size: contain; 
    background-position:50% 50%; background-repeat:no-repeat; display:none;" title="Remove texture"></a>



    <h4><input type="checkbox" id="check-alphaMap" class="one-4-all"> Alpha Map:</h4>

    <div class="btn btn-primary btn-white-outline form-control texture-btn" id="import-alphaMap-btn">Import Alpha Map</div>

    <a id="library-alphaMap" name="library-alphaMap" class="nav-link btn btn-default btn-white-outline import-texture-btn" 
    style="width:79px; height:79px; background-image: url('https://i.imgur.com/Fi1O5YL.png'); background-size: contain; 
    background-position:50% 50%; background-repeat:no-repeat;" title="Import from library"></a>

    <a id="internet-alphaMap" name="internet-alphaMap" class="nav-link btn btn-default btn-white-outline import-texture-btn" 
    style="width:79px; height:79px; background-image: url('https://i.imgur.com/m8ZMtd5.png'); background-size: contain; 
    background-position:50% 50%; background-repeat:no-repeat;" title="Import from internet"></a>

    <a id="desktop-alphaMap" name="desktop-alphaMap" class="nav-link btn btn-default btn-white-outline import-texture-btn" 
    style="width:79px; height:79px; background-image: url('https://i.imgur.com/vfpmSfl.png'); background-size: contain; 
    background-position:50% 50%; background-repeat:no-repeat;" title="Import from desktop"></a>

    <a id="remove-alphaMap" name="remove-alphaMap" class="nav-link btn btn-default btn-white-outline remove-texture-btn" 
    style="width:79px; height:79px; background-image: url('https://i.imgur.com/R7Iu9bW.png'); background-size: contain; 
    background-position:50% 50%; background-repeat:no-repeat; display:none;" title="Remove texture"></a>



    <h4><input type="checkbox" id="check-aoMap" class="one-4-all"> AO Map:</h4>
    <ul>
        <li>
            <label for="aoMapIntensity-output" title="Edit material aoMapIntensity">AO Map Intensity:</label>
            <input type="number" id="aoMapIntensity-output" class="panel-controls-output pull-right" value="1" step="0.01">
        </li>
    </ul>

    <div class="btn btn-primary btn-white-outline form-control texture-btn" id="import-aoMap-btn">Import AOMap</div>

    <a id="library-aoMap" name="library-aoMap" class="nav-link btn btn-default btn-white-outline import-texture-btn" 
    style="width:79px; height:79px; background-image: url('https://i.imgur.com/Fi1O5YL.png'); background-size: contain; 
    background-position:50% 50%; background-repeat:no-repeat;" title="Import from library"></a>

    <a id="internet-aoMap" name="internet-aoMap" class="nav-link btn btn-default btn-white-outline import-texture-btn" 
    style="width:79px; height:79px; background-image: url('https://i.imgur.com/m8ZMtd5.png'); background-size: contain; 
    background-position:50% 50%; background-repeat:no-repeat;" title="Import from internet"></a>

    <a id="desktop-aoMap" name="desktop-aoMap" class="nav-link btn btn-default btn-white-outline import-texture-btn" 
    style="width:79px; height:79px; background-image: url('https://i.imgur.com/vfpmSfl.png'); background-size: contain; 
    background-position:50% 50%; background-repeat:no-repeat;" title="Import from desktop"></a>

    <a id="remove-aoMap" name="remove-aoMap" class="nav-link btn btn-default btn-white-outline remove-texture-btn" 
    style="width:79px; height:79px; background-image: url('https://i.imgur.com/R7Iu9bW.png'); background-size: contain; 
    background-position:50% 50%; background-repeat:no-repeat; display:none;" title="Remove texture"></a>



    <h4><input type="checkbox" id="check-lightMap" class="one-4-all"> Light Map:</h4>
    <ul>
        <li>
            <label for="lightMapIntensity-output" title="Edit material lightMapIntensity">Light Map Intensity:</label>
            <input type="number" id="lightMapIntensity-output" class="panel-controls-output pull-right" value="1" step="0.01">
        </li>
    </ul>

    <div class="btn btn-primary btn-white-outline form-control texture-btn" id="import-lightMap-btn">Import LigthMap</div>

    <a id="library-lightMap" name="library-lightMap" class="nav-link btn btn-default btn-white-outline import-texture-btn" 
    style="width:79px; height:79px; background-image: url('https://i.imgur.com/Fi1O5YL.png'); background-size: contain; 
    background-position:50% 50%; background-repeat:no-repeat;" title="Import from library"></a>

    <a id="internet-lightMap" name="internet-lightMap" class="nav-link btn btn-default btn-white-outline import-texture-btn" 
    style="width:79px; height:79px; background-image: url('https://i.imgur.com/m8ZMtd5.png'); background-size: contain; 
    background-position:50% 50%; background-repeat:no-repeat;" title="Import from internet"></a>

    <a id="desktop-lightMap" name="desktop-lightMap" class="nav-link btn btn-default btn-white-outline import-texture-btn" 
    style="width:79px; height:79px; background-image: url('https://i.imgur.com/vfpmSfl.png'); background-size: contain; 
    background-position:50% 50%; background-repeat:no-repeat;" title="Import from desktop"></a>

    <a id="remove-lightMap" name="remove-lightMap" class="nav-link btn btn-default btn-white-outline remove-texture-btn" 
    style="width:79px; height:79px; background-image: url('https://i.imgur.com/R7Iu9bW.png'); background-size: contain; 
    background-position:50% 50%; background-repeat:no-repeat; display:none;" title="Remove texture"></a>



    <h4>Environment map:</h4>

    <div class="btn btn-primary btn-white-outline form-control texture-btn" id="import-envMap-btn">Import Environment Map</div>

    <a id="library-envMap" name="library-envMap" class="nav-link btn btn-default btn-white-outline import-texture-btn" 
    style="width:79px; height:79px; background-image: url('https://i.imgur.com/Fi1O5YL.png'); background-size: contain; 
    background-position:50% 50%; background-repeat:no-repeat;" title="Import from library"></a>

    <a id="internet-envMap" name="internet-envMap" class="nav-link btn btn-default btn-white-outline import-texture-btn" 
    style="width:79px; height:79px; background-image: url('https://i.imgur.com/m8ZMtd5.png'); background-size: contain; 
    background-position:50% 50%; background-repeat:no-repeat;" title="Import from internet"></a>

    <a id="desktop-envMap" name="desktop-envMap" class="nav-link btn btn-default btn-white-outline import-texture-btn" 
    style="width:79px; height:79px; background-image: url('https://i.imgur.com/vfpmSfl.png'); background-size: contain; 
    background-position:50% 50%; background-repeat:no-repeat;" title="Import from desktop"></a>

    <a id="remove-envMap" name="remove-envMap" class="nav-link btn btn-default btn-white-outline remove-texture-btn" 
    style="width:79px; height:79px; background-image: url('https://i.imgur.com/R7Iu9bW.png'); background-size: contain; 
    background-position:50% 50%; background-repeat:no-repeat; display:none;" title="Remove texture"></a>

    <input type="file" class="hidden" id="map-input">
    <input type="file" class="hidden" id="emissiveMap-input">
    <input type="file" class="hidden" id="specularMap-input">    
    <input type="file" class="hidden" id="alphaMap-input">
    <input type="file" class="hidden" id="aoMap-input">
    <input type="file" class="hidden" id="lightMap-input">    
    <input type="file" class="hidden" id="envMap-input">

</div>


<div id="lambert-material-panel-emissive-col" class="col-md-6 col-panel">
    <h4>Edit emissive color:</h4>
    <li>
        <label for="emissiveIntensity-output" title="Edit material emissiveIntensity">Emissive Intensity:</label>
        <input type="number" id="emissiveIntensity-output" class="panel-controls-output pull-right" value="1" step="0.01">
    </li>
    <input type="hidden" id="sp-target-emissive">
</div>


<div id="lambert-material-map-right-col" class="col-md-6 col-panel">

    <h4 style="margin-top:8px;"><input type="checkbox" id="check-map" class="one-4-all"> Diffuse map:</h4>

    <div class="btn btn-primary btn-white-outline form-control texture-btn" id="import-map-btn">Import map</div>

    <a id="library-map" name="library-map" class="nav-link btn btn-default btn-white-outline import-texture-btn" 
    style="width:79px; height:79px; background-image: url('https://i.imgur.com/Fi1O5YL.png'); background-size: contain; 
    background-position:50% 50%; background-repeat:no-repeat;" title="Import from library"></a>

    <a id="internet-map" name="internet-map" class="nav-link btn btn-default btn-white-outline import-texture-btn" 
    style="width:79px; height:79px; background-image: url('https://i.imgur.com/m8ZMtd5.png'); background-size: contain; 
    background-position:50% 50%; background-repeat:no-repeat;" title="Import from internet"></a>

    <a id="desktop-map" name="desktop-map" class="nav-link btn btn-default btn-white-outline import-texture-btn" 
    style="width:79px; height:79px; background-image: url('https://i.imgur.com/vfpmSfl.png'); background-size: contain; 
    background-position:50% 50%; background-repeat:no-repeat;" title="Import from desktop"></a>

    <a id="remove-map" name="remove-map" class="nav-link btn btn-default btn-white-outline remove-texture-btn" 
    style="width:79px; height:79px; background-image: url('https://i.imgur.com/R7Iu9bW.png'); background-size: contain; 
    background-position:50% 50%; background-repeat:no-repeat; display:none;" title="Remove texture"></a>

</div>


<div id="lambert-material-panel-diffuse-col" class="col-md-6 col-panel">

    <h4>Edit color:</h4>
    <input type="hidden" id="sp-target-color">

</div>


<div id="lambert-material-options-right-col" class="col-md-6 col-panel">

    <h4 style="margin-top:8px;">Options:</h4>

    <ul>
        <li>
            <label for="shininess-output" title="Indicate shininess of material">Shininess:</label>
            <input type="number" id="shininess-output" class="panel-controls-output pull-right" value="0" step="1">
        </li>
        <li>
            <label for="reflectivity-output" title="Set reflectivity">Reflectivity:</label>
            <input type="number" id="reflectivity-output" class="panel-controls-output pull-right" value="1" step="0.01">
        </li>
        <li>
            <label for="refractionRatio-output" title="Set refraction ratio">Refraction Ratio:</label>
            <input type="number" id="refractionRatio-output" class="panel-controls-output pull-right" value="0.98" step="0.01">
        </li>
        <li>
            <label for="opacity-output" title="Indicate transparent of material.">Opacity:</label>
            <input type="number" id="opacity-output" class="panel-controls-output pull-right" min="0" max="1" value="1" step="0.01">
        </li>
        <li>
            <label for="transparent-checkbox" title="Defines whether material is transparent.">Transparent:</label>
            <input type="checkbox" id="transparent-checkbox" class="panel-controls-output pull-right">
        </li>
        <li>
            <label for="skinning-checkbox" title="Material uses skinning">Skinning:</label>
            <input type="checkbox" id="skinning-checkbox" class="panel-controls-output pull-right" checked disabled>
        </li>
        <li>
            <label for="depthTest-checkbox" title="Whether to have depth test enabled">Depth Test:</label>
            <input type="checkbox" id="depthTest-checkbox" class="panel-controls-output pull-right" checked>
        </li>
        <li>
            <label for="depthWrite-checkbox" title="Whether rendering this material has any effect on the depth buffer">Depth Write:</label>
            <input type="checkbox" id="depthWrite-checkbox" class="panel-controls-output pull-right" checked>
        </li>
        <li>
            <label for="needs-update-checkbox" title="Defines whether this material is visible">Need update:</label>
            <input type="checkbox" id="needs-update-checkbox" class="panel-controls-output pull-right">
        </li>  
        <li>
            <label for="visible-checkbox" title="Defines whether this material is visible">Visible:</label>
            <input type="checkbox" id="visible-checkbox" class="panel-controls-output pull-right" checked>
        </li>        
        <li>
            <label for="side-checkbox" title="Defines which of the face sides will be rendered on both sides">Both sides:</label>
            <input type="checkbox" id="side-checkbox" class="panel-controls-output pull-right">
        </li>
    </ul>

</div>

<script>
/*
    var dialogTargetEventListenersScript = "/js/dialogTargetEventListeners.js";
    $.getScript(dialogTargetEventListenersScript, function(script, status, xhr){
        debugMode && console.log("dialogTargetEventListeners:", status);
    });
*/
</script>

    <!-- LOAD SCRIPT FUNCTIONS -->

<script>

    var makePowerOfTwoScript = scriptsFolder + "makePowerOfTwo.js";
    $.getScript(makePowerOfTwoScript, function(script, status, xhr){
        if (status == "error") console.error( status, xhr.status, xhr.statusText );
        if (status == "success") debugMode && console.log( "makePowerOfTwo:", status );
    });

    var deallocateTexturesScript = scriptsFolder + "deallocateTextures.js";
    $.getScript(deallocateTexturesScript, function(script, status, xhr){
        if (status == "error") console.error( status, xhr.status, xhr.statusText );
        if (status == "success") debugMode && console.log( "deallocateTextures:", status );
    });

</script>

<script>

//  Dialog panel control elements.

//  Every dialoge panel point to a target object that can be 
//  mesh, geometry, face, vertex, object3d, material, texture
//  or whatever and deals with this target only.

//  Maps.

    var emissiveIntensitySelector = "#emissiveIntensity-output";
    var aoMapIntensitySelector = "#aoMapIntensity-output";
    var lightMapIntensitySelector = "#lightMapIntensity-output";
    var envMapIntensitySelector = "#envMapIntensity-output";

//  Options.

    var shininessSelector = "#shininess-output";
    var reflectivitySelector = "#reflectivity-output";
    var refractionRatioSelector = "#refractionRatio-output";
    var opacitySelector = "#opacity-output";
    var transparentSelector = "#transparent-checkbox";
    var depthTestSelector = "#depthTest-checkbox";
    var depthWriteSelector = "#depthWrite-checkbox";
    var needsUpdateSelector = "#needs-update-checkbox";
    var visibleSelector = "#visible-checkbox";
    var bothSideSelector = "#side-checkbox";

    if ( !!target ) {

        $(emissiveIntensitySelector).val(target.emissiveIntensity);
        targetInputEventListener(emissiveIntensitySelector, "emissiveIntensity");

        $(aoMapIntensitySelector).val(target.aoMapIntensity);
        targetInputEventListener(aoMapIntensitySelector, "aoMapIntensity");

        $(lightMapIntensitySelector).val(target.lightMapIntensity);
        targetInputEventListener(lightMapIntensitySelector, "lightMapIntensity");

        $(envMapIntensitySelector).val(target.envMapIntensity);
        targetInputEventListener(envMapIntensitySelector, "envMapIntensity");

    }

    if ( !!target ) {

    //  Options.

        $(shininessSelector).val(target.shininess);
        targetInputEventListener(shininessSelector, "shininess");

        $(refractionRatioSelector).val(target.reflectivity);
        targetInputEventListener(reflectivitySelector, "reflectivity");

        $(refractionRatioSelector).val(target.refractionRatio);
        targetInputEventListener(refractionRatioSelector, "refractionRatio");

        $(opacitySelector).val(target.opacity);
        targetInputEventListener(opacitySelector, "opacity");

        $(transparentSelector)[0].checked = target.transparent;
        targetCheckedEventListener(transparentSelector, "transparent");

        $(depthTestSelector)[0].checked = target.depthTest;
        targetCheckedEventListener(depthTestSelector, "depthTest");

        $(depthWriteSelector)[0].checked = target.depthWrite;
        targetCheckedEventListener(depthWriteSelector, "depthWrite");

        $(needsUpdateSelector)[0].checked = target.needsUpdate;
        targetCheckedEventListener(needsUpdateSelector, "needsUpdate");

        $(visibleSelector)[0].checked = target.visible;
        targetCheckedEventListener(visibleSelector, "visible");

        $(bothSideSelector)[0].checked = (target.side == 2);
        $(bothSideSelector).on("click", function(){
            if ( this.checked ) 
                target.side = 2;
            else
                target.side = 0;
        });

    }

</script>

<!-- 
    <input type="file" class="hidden" id="map-input">
    <input type="file" class="hidden" id="emissiveMap-input">
    <input type="file" class="hidden" id="specularMap-input">    
    <input type="file" class="hidden" id="alphaMap-input">
    <input type="file" class="hidden" id="aoMap-input">
    <input type="file" class="hidden" id="lightMap-input">    
    <input type="file" class="hidden" id="envMap-input">
 -->

<script>

//  LambertMaterialTextureMapsImport.js

    var mapImportSelector = "#import-map-btn";
    var emissiveMapImportSelector = "#import-emissiveMap-btn";
    var specularMapImportSelector = "#import-specularMap-btn";
    var alphaMapImportSelector = "#import-alphaMap-btn";
    var aoMapImportSelector = "#import-aoMap-btn";
    var lightMapImportSelector = "#import-lightMap-btn";
    var envMapImportSelector = "#import-envMap-btn";

    var mapInputSelector = "#map-input";
    var emissiveMapInputSelector = "#emissiveMap-input";
    var specularMapInputSelector = "#specularMap-input";
    var alphaMapInputSelector = "#alphaMap-input";
    var aoMapInputSelector = "#aoMap-input";
    var lightMapInputSelector = "#lightMap-input";
    var envMapInputSelector = "#envMap-input";

    var checkMapSelector    = "#check-map";
    var libraryMapSelector  = "#library-map";
    var internetMapSelector = "#internet-map";
    var desktopMapSelector  = "#desktop-map";
    var removeMapSelector   = "#remove-map";

    var checkEmissiveMapSelector    = "#check-emissiveMap";
    var libraryEmissiveMapSelector  = "#library-emissiveMap";
    var internetEmissiveMapSelector = "#internet-emissiveMap";
    var desktopEmissiveMapSelector  = "#desktop-emissiveMap";
    var removeEmissiveMapSelector   = "#remove-emissiveMap";

    var checkSpecularMapSelector    = "#check-specularMap";
    var librarySpecularMapSelector  = "#library-specularMap";
    var internetSpecularMapSelector = "#internet-specularMap";
    var desktopSpecularMapSelector  = "#desktop-specularMap";
    var removeSpecularMapSelector   = "#remove-specularMap";

    var checkAlphaMapSelector    = "#check-alphaMap";
    var libraryAlphaMapSelector  = "#library-alphaMap";
    var internetAlphaMapSelector = "#internet-alphaMap";
    var desktopAlphaMapSelector  = "#desktop-alphaMap";
    var removeAlphaMapSelector   = "#remove-alphaMap";

    var checkAOMapSelector    = "#check-aoMap";
    var libraryAOMapSelector  = "#library-aoMap";
    var internetAOMapSelector = "#internet-aoMap";
    var desktopAOMapSelector  = "#desktop-aoMap";
    var removeAOMapSelector   = "#remove-aoMap";

    var checkLightMapSelector    = "#check-lightMap";
    var libraryLightMapSelector  = "#library-lightMap";
    var internetLightMapSelector = "#internet-lightMap";
    var desktopLightMapSelector  = "#desktop-lightMap";
    var removeLightMapSelector   = "#remove-lightMap";

    var libraryEnvMapSelector  = "#library-envMap";
    var internetEnvMapSelector = "#internet-envMap";
    var desktopEnvMapSelector  = "#desktop-envMap";
    var removeEnvMapSelector   = "#remove-envMap";


//  One for all checked textures.
    $(checkMapSelector)[0].checked = true;
    $(checkEmissiveMapSelector)[0].checked = true;


    if ( !!target ) {

        targetClickFileInputEventListener(mapImportSelector, mapInputSelector);
        targetClickFileInputEventListener(emissiveMapImportSelector, emissiveMapInputSelector);
        targetClickFileInputEventListener(specularMapImportSelector, specularMapInputSelector);
        targetClickFileInputEventListener(alphaMapImportSelector, alphaMapInputSelector);
        targetClickFileInputEventListener(aoMapImportSelector, aoMapInputSelector);
        targetClickFileInputEventListener(lightMapImportSelector, lightMapInputSelector);
        targetClickFileInputEventListener(envMapImportSelector, envMapInputSelector);
    }

    if ( !!target ) {

        targetDesktopMapFileInputEventListener(specularMapInputSelector, "specularMap", function(){
            toggleImportRemoveButton(desktopSpecularMapSelector, removeSpecularMapSelector, "specularMap");
        });

        targetDesktopMapFileInputEventListener(alphaMapInputSelector, "alphaMap", function(){
            toggleImportRemoveButton(desktopAlphaMapSelector, removeAlphaMapSelector, "alphaMap");
        });

        targetDesktopMapFileInputEventListener(aoMapInputSelector, "aoMap", function(){
            toggleImportRemoveButton(desktopAOMapSelector, removeAOMapSelector, "aoMap");
        });

        targetDesktopMapFileInputEventListener(lightMapInputSelector, "lightMap", function(){
            toggleImportRemoveButton(desktopLightMapSelector, removeLightMapSelector, "lightMap");
        });

        targetDesktopMapFileInputEventListener(envMapInputSelector, "envMap", function(){
            toggleImportRemoveButton(desktopEnvMapSelector, removeEnvMapSelector, "envMap");
        });

        targetDesktopMapFileInputEventListener(emissiveMapInputSelector, "emissiveMap", function(){
            if ( !!target["emissiveMap"] && $("#check-emissiveMap")[0].checked ){
                var texture = target["emissiveMap"];

            //  Dispose textures.
                var repeatedMaps = [];


                if ( $("#check-specularMap")[0].checked ) repeatedMaps.push( target[ "specularMap" ] );
                if ( $("#check-alphaMap")[0].checked ) repeatedMaps.push( target[ "alphaMap" ] );
                if ( $("#check-aoMap")[0].checked ) repeatedMaps.push( target[ "aoMap" ] );
                if ( $("#check-lightMap")[0].checked ) repeatedMaps.push( target[ "lightMap" ] );
            //  if ( $("#check-emissiveMap")[0].checked ) repeatedMaps.push( target[ "emissiveMap" ] );
                if ( $("#check-map")[0].checked ) repeatedMaps.push( target[ "map" ] );

                deallocateTextures.apply( null, repeatedMaps );

            //  Apply texture.
                if ( $("#check-specularMap")[0].checked ) target[ "specularMap" ] = texture;
                if ( $("#check-alphaMap")[0].checked ) target[ "alphaMap" ] = texture;
                if ( $("#check-aoMap")[0].checked ) target[ "aoMap" ] = texture;
                if ( $("#check-lightMap")[0].checked ) target[ "lightMap" ] = texture;
            //  if ( $("#check-emissiveMap")[0].checked ) target[ "emissiveMap" ] = texture;
                if ( $("#check-map")[0].checked ) target[ "map" ] = texture;

            //  Update import/remove button.
                toggleImportRemoveButton(desktopSpecularMapSelector, removeSpecularMapSelector, "specularMap");
                toggleImportRemoveButton(desktopAlphaMapSelector, removeAlphaMapSelector, "alphaMap");
                toggleImportRemoveButton(desktopAOMapSelector, removeAOMapSelector, "aoMap");
                toggleImportRemoveButton(desktopLightMapSelector, removeLightMapSelector, "lightMap");
                toggleImportRemoveButton(desktopEmissiveMapSelector, removeEmissiveMapSelector, "emissiveMap");
                toggleImportRemoveButton(desktopMapSelector, removeMapSelector, "map");

            //  Update material.
                target.needsUpdate = true;

            } else {
                toggleImportRemoveButton(desktopEmissiveMapSelector, removeEmissiveMapSelector, "emissiveMap");
            }
        });

        targetDesktopMapFileInputEventListener(mapInputSelector, "map", function(){
            if ( !!target["map"] && $("#check-map")[0].checked ){
                var texture = target["map"];

            //  Dispose textures.
                var repeatedMaps = [];


                if ( $("#check-specularMap")[0].checked ) repeatedMaps.push( target[ "specularMap" ] );
                if ( $("#check-alphaMap")[0].checked ) repeatedMaps.push( target[ "alphaMap" ] );
                if ( $("#check-aoMap")[0].checked ) repeatedMaps.push( target[ "aoMap" ] );
                if ( $("#check-lightMap")[0].checked ) repeatedMaps.push( target[ "lightMap" ] );
                if ( $("#check-emissiveMap")[0].checked ) repeatedMaps.push( target[ "emissiveMap" ] );
            //  if ( $("#check-map")[0].checked ) repeatedMaps.push( target[ "map" ] );

                deallocateTextures.apply( null, repeatedMaps );

            //  Apply texture.
                if ( $("#check-specularMap")[0].checked ) target[ "specularMap" ] = texture;
                if ( $("#check-alphaMap")[0].checked ) target[ "alphaMap" ] = texture;
                if ( $("#check-aoMap")[0].checked ) target[ "aoMap" ] = texture;
                if ( $("#check-lightMap")[0].checked ) target[ "lightMap" ] = texture;
                if ( $("#check-emissiveMap")[0].checked ) target[ "emissiveMap" ] = texture;
            //  if ( $("#check-map")[0].checked ) target[ "map" ] = texture;

            //  Update import/remove button.
                toggleImportRemoveButton(desktopSpecularMapSelector, removeSpecularMapSelector, "specularMap");
                toggleImportRemoveButton(desktopAlphaMapSelector, removeAlphaMapSelector, "alphaMap");
                toggleImportRemoveButton(desktopAOMapSelector, removeAOMapSelector, "aoMap");
                toggleImportRemoveButton(desktopLightMapSelector, removeLightMapSelector, "lightMap");
                toggleImportRemoveButton(desktopEmissiveMapSelector, removeEmissiveMapSelector, "emissiveMap");
                toggleImportRemoveButton(desktopMapSelector, removeMapSelector, "map");

            //  Update material.
                target.needsUpdate = true;

            } else {
                toggleImportRemoveButton(desktopMapSelector, removeMapSelector, "map");
            }
        });

    }

    if ( !!target ) {

        targetClickFileInputEventListener(desktopMapSelector, mapInputSelector);
        targetRemoveTextureEventListener(desktopMapSelector, removeMapSelector, "map");
        toggleImportRemoveButton(desktopMapSelector, removeMapSelector, "map");

        targetClickFileInputEventListener(desktopEmissiveMapSelector, emissiveMapInputSelector);
        targetRemoveTextureEventListener(desktopEmissiveMapSelector, removeEmissiveMapSelector, "emissiveMap");
        toggleImportRemoveButton(desktopEmissiveMapSelector, removeEmissiveMapSelector, "emissiveMap");

        targetClickFileInputEventListener(desktopSpecularMapSelector, specularMapInputSelector);
        targetRemoveTextureEventListener(desktopSpecularMapSelector, removeSpecularMapSelector, "specularMap");
        toggleImportRemoveButton(desktopSpecularMapSelector, removeSpecularMapSelector, "specularMap");

        targetClickFileInputEventListener(desktopAlphaMapSelector, alphaMapInputSelector);
        targetRemoveTextureEventListener(desktopAlphaMapSelector, removeAlphaMapSelector, "alphaMap");
        toggleImportRemoveButton(desktopAlphaMapSelector, removeAlphaMapSelector, "alphaMap");

        targetClickFileInputEventListener(desktopAOMapSelector, aoMapInputSelector);
        targetRemoveTextureEventListener(desktopAOMapSelector, removeAOMapSelector, "aoMap");
        toggleImportRemoveButton(desktopAOMapSelector, removeAOMapSelector, "aoMap");

        targetClickFileInputEventListener(desktopLightMapSelector, lightMapInputSelector);
        targetRemoveTextureEventListener(desktopLightMapSelector, removeLightMapSelector, "lightMap");
        toggleImportRemoveButton(desktopLightMapSelector, removeLightMapSelector, "lightMap");

        targetClickFileInputEventListener(desktopEnvMapSelector, envMapInputSelector);
        targetRemoveTextureEventListener(desktopEnvMapSelector, removeEnvMapSelector, "envMap");
        toggleImportRemoveButton(desktopEnvMapSelector, removeEnvMapSelector, "envMap");

    }

</script>


<script>

//  Spectrum Colorpickers.js

    var spectrumColorSelector    = "#sp-target-color";
    var spectrumEmissiveSelector = "#sp-target-emissive";

    $(spectrumColorSelector).spectrum({
        preferredFormat: "hex",
        color: "#ffffff",
        flat: true,
        showInput: true,
        showInitial: true,
        showButtons: false,
        allowEmpty: false,
        move: function(color) {
            if ( !target) return;
            var hex = color.toString("hex").replace(/#/, "0x");
            target.color.setHex( hex );
        }
    });

    $(spectrumEmissiveSelector).spectrum({
        preferredFormat: "hex",
        color: "#000000",
        flat: true,
        showInput: true,
        showInitial: true,
        showButtons: false,
        allowEmpty: false,
        move: function(color) {
            if ( !target) return;
            var hex = color.toString("hex").replace(/#/, "0x");
            target.emissive.setHex( hex );
        }
    });

//  TODO: When target then send this color value to your remote player.

    $(spectrumColorSelector).on("dragstop.spectrum", function(e, color) {
   //  debugMode && console.log( "diffuse color on dragstop:", color.toHexString() );        
        if ( !target) {
            $(this).spectrum( "set", "#ffffff" ); 
            return;
        }
    });

    $(spectrumEmissiveSelector).on("dragstop.spectrum", function(e, color) {
    //  debugMode && console.log( "emissive color on dragstop:", color.toHexString() );
        if ( !target) {
            $(this).spectrum( "set", "#000000" );
            return;
        }
    });

    updateTargetColorpickers();

    function updateTargetColorpickers(){
    //  Colorpickers update.
        if (!target) return;
        var colorHex = "#" + target.color.getHexString();
        var emissiveHex = "#" + target.emissive.getHexString();
        $(spectrumColorSelector).spectrum( "set", colorHex );
        $(spectrumEmissiveSelector).spectrum( "set", emissiveHex );
    }

</script>



<script>
/*
    $OutfitEditorPanel.dialog( "option", {
        width: 616,
        minWidth: 616,
        maxWidth: 616,
        height: 600,
        minHeight: 600,
        maxHeight: 600
    });

//  Open dialog.
    $OutfitEditorPanel.dialog("open");
*/
</script>












<script>
/*
//  dialogTargetEventListeners.js

    var texture_size;

    function targetremoveInputEventListener(selector){
        $(selector).off("input");
    }

    function targetremoveChangeEventListener(selector){
        $(selector).off("change");
    }

    function targetremoveClickEventListener(selector){
        $(selector).off("click");
    }

    function targetInputEventListener(selector, option){
        $(selector).on("input", function(){
            target[ option ] = parseFloat( this.value );
        });
    }

    function targetChangeEventListener(selector, option){
        $(selector).on("change", function(){
            target[ option ] = parseFloat( this.value );
        });
    }

    function targetCheckedEventListener(selector, option){
        $(selector).on("click", function(){
            target[ option ] = this.checked;
        });
    }

    function targetClickFileInputEventListener(selector, fileinputSelector){
        $(selector).on( "click", function(){
            if (!target) return;
            $(fileinputSelector).val("");  // reset Filelist.
            $(fileinputSelector).click();  // open file input window.
        });
    }

    function targetDesktopMapFileInputEventListener(selector, map, callback){
        
        $(selector).on("change", function(e){

            if (!target) return;
            if ( e.currentTarget.files.length == 0 ) return;
    
        //  Get file, name and extension.
            var file = e.currentTarget.files[0];
            var filename = file.name;
            debugMode && console.log("filename:", filename);
    
            var ext = filename.split( "." ).pop().toLowerCase();
            var name = filename.split( "." ); name.pop(); 
            name = name.join( "." ).replace(/\W/g, "_");
            debugMode && console.log("name:", name, "extension:", ext);
    
        //  File Reader.
            var reader = new FileReader();
            reader.onerror = onReaderError;
            reader.onload = onReaderLoad;
            reader.readAsDataURL(file);
    
            function onReaderError(err){
                console.error(err);
            }
    
            function onReaderLoad(event){
                var img = new Image();
                img.crossOrigin = "anonymous";
                img.onload = onImageLoad;
                img.src = reader.result;
            }
    
            function onImageLoad(){
                var canvas = makeFixedPowerOfTwo( this, textureSize ); // "this" is "img".
                if (!!canvas){
                    var texture = new THREE.Texture( canvas );
                    texture.name = name;
                    texture.sourceFile = "/desktop/fakepath/" + file.name;
                    debugMode && console.log( "Texture has been created:", texture );
    
                //  Dispose old texture.
                    if (!!target[ map ]) {
                        deallocateTextures( target[ map ] );
                        target[ map ] = null;
                    }

                //  Apply texture.
                    target[ map ] = texture;
                    target[ map ].needsUpdate = true;
                    target.needsUpdate = true;
                    
                //  callback.
                    if (!!callback) callback();
                }
    
            //  Delete image.
                $(this).remove(); debugMode && console.log( "Texture image has been removed." );
            }
    
        });
    }

    function targetRemoveTextureEventListener(importSelector, removeSelector, map){
        $(removeSelector).on("click", function(){
            if (!!target[ map ]) {
            //  Dispose texture.
                deallocateTextures( target[ map ] );
                target[ map ] = null;
                target.needsUpdate = true;
            //  Show import button.
                $(importSelector).show();
                $(removeSelector).hide();
            }
        });
    }

    function toggleImportRemoveButton(importSelector, removeSelector, map){
        if (!!target[ map ]) {
            $(importSelector).hide();
            $(removeSelector).show();
        } else {
            $(importSelector).show();
            $(removeSelector).hide();
        }
    }
*/
</script>



<!-- 
<div id="outfit-skintone-female-col" class="col-md-6 col-panel" style="display:none;">

    <h4>Select skintone:</h4>

    <a id="skin-map-fmSkinLight" name="fmSkinLight" class="nav-link btn btn-default btn-white-outline skin-texture-btn" 
    style="width:79px; height:79px; background-image: url('/img/fmSkinLight.png'); background-size: contain; 
    background-position:50% 50%; background-repeat:no-repeat;" title="Skin: fmSkinLight"></a>

    <a id="skin-map-fmSkinMedium" name="fmSkinMedium" class="nav-link btn btn-default btn-white-outline skin-texture-btn" 
    style="width:79px; height:79px; background-image: url('/img/fmSkinMedium.png'); background-size: contain; 
    background-position:50% 50%; background-repeat:no-repeat;" title="Skin: fmSkinMedium"></a>

    <a id="skin-map-fmSkinDark" name="fmSkinDark" class="nav-link btn btn-default btn-white-outline skin-texture-btn" 
    style="width:79px; height:79px; background-image: url('/img/fmSkinDark.png'); background-size: contain; 
    background-position:50% 50%; background-repeat:no-repeat;" title="Skin: fmSkinDark"></a>

</div>
<div id="outfit-skintone-male-col" class="col-md-6 col-panel" style="display:none;">

    <h4>Select skintone:</h4>

    <a id="skin-map-hmSkinLight" name="hmSkinLight" class="nav-link btn btn-default btn-white-outline skin-texture-btn" 
    style="width:79px; height:79px; background-image: url('/img/hmSkinLight.png'); background-size: contain; 
    background-position:50% 50%; background-repeat:no-repeat;" title="Skin: hmSkinLight"></a>

    <a id="skin-map-hmSkinMedium" name="hmSkinMedium" class="nav-link btn btn-default btn-white-outline skin-texture-btn" 
    style="width:79px; height:79px; background-image: url('/img/hmSkinMedium.png'); background-size: contain; 
    background-position:50% 50%; background-repeat:no-repeat;" title="Skin: hmSkinMedium"></a>

    <a id="skin-map-hmSkinDark" name="hmSkinDark" class="nav-link btn btn-default btn-white-outline skin-texture-btn" 
    style="width:79px; height:79px; background-image: url('/img/hmSkinDark.png'); background-size: contain; 
    background-position:50% 50%; background-repeat:no-repeat;" title="Skin: hmSkinDark"></a>

</div>
 -->
